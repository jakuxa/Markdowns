## 导入模板校验技术

> 内容摘录于视频《20200317.导入模板校验》

### 使用场景

- 非标与基金辅助信息涉及跨sheet页的校验 

### 一、XML解析

| xml标签                 | 标签内容                                                     | 备注                                                         |
| ----------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| <sheetName>             | 与sheet页名称保持一致                                        |                                                              |
| <startRow>              | 从第几行开始，min=0                                          |                                                              |
| <titleRowNo>            | 标题行的行数，min=0                                          |                                                              |
| <skipError>             | 校验遇到错误时是否跳过，0=否，1=是                           | 默认0就完事了                                                |
| <check>                 | 标签内的内容是校验规则列表                                   |                                                              |
| <cell>                  | 标签内的内容是单元格内的校验规则配置                         | （或为单元列）                                               |
| <colName>               | 单元格列标题                                                 |                                                              |
| <rules>                 | 内容是校验规则，以下直到</rules>皆为内容标签                 |                                                              |
| <notNull>               | 是否可以为空，不可为空=1，可为空=0                           |                                                              |
| <length>                | 单元格内容长度                                               |                                                              |
| <sqlCheck>              | 内容是后置校验sql语句，单个'?'作为当前单元格值的占位符       | 具体有啥功能，没听懂，在视频2-4分钟                          |
| <repeatCheck>           | 单元格内容的描述                                             | 所有涉及占位符的sql语句公用一个paramList属性                 |
| <describe>              | 单元格内容的描述                                             |                                                              |
| <notNullBySql>          | 根据内容的sql语句进行判断到底可不可以为空                    | 可以有多个'?'占位符                                          |
| <paramList>             | 当sql中占位符不止一个，且需要依赖sheet页内其他字段时，包含的字段名称 | 多个字段按占位符顺序排列，以“,”分割，如<paramList>产品品种，是否大集合，是否社保</paramList> |
| <inList>                | 数据字典                                                     | 以","分割，如<inList>是,否</inList>                          |
| <inDicItem>             | 也是数据字典，但内容仅为编号，该编号会用于指定查询。         | select * from dictionary_item where 编号='?'                 |
| <isDate>                | 是否为日期格式，否=0，是=1                                   |                                                              |
| <depdenceRequired>      | 内容是同sheet页依赖字段名称，依赖存在，则当前字段必填        |                                                              |
| <depdenceRequiredValue> |                                                              |                                                              |
| <depdenceValueList>     | 多个依赖值存在时必填                                         | 以","分割                                                    |
| <isNumber>              | 是否是数字，否=0，是=1                                       |                                                              |
| <number>                | 数字格式                                                     |                                                              |
| </rules>                |                                                              | rules标签结束                                                |
| <table>                 | 标签内的内容是导数据页的配置                                 |                                                              |
| <isPrimaryKey>          | 是否是主键                                                   | 执行sql时，主键重复会更新，而不是插入                        |
| <sql>                   | 要执行的业务语句                                             |                                                              |
| <tableField>            | 表所在域,oracle                                              | 大小写要注意，需要和数据库一致，尽量全要大写                 |
| <paramList>             | sql中的占位符属性列表                                        |                                                              |
| <transfers>             | 内容是数据转换列表                                           |                                                              |
| <transfer>              | 数据转换规则                                                 |                                                              |
| <from>                  | 数据转换原值                                                 | 如<from>是</from>                                            |
| <to>                    | 数据转换新值                                                 | 如<to>1</to>                                                 |
| <sysField>              | 固定配置                                                     | 参考视频25分钟左右                                           |


### 二、注意点

- 导入时，并非按照sheet页顺序，而是按照xml配置进行。因此导入时，xml顺序与模板必须一一对应。

- xml仅做批量导入时的校验，后续输入时在hui中校验格式，其他特殊校验在提交后台时校验。

- 相关实现请看ExcelImportor类